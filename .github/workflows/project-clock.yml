name: Project Clock (Manual Summary)

on:
  workflow_dispatch: {}

permissions:
  contents: write

jobs:
  clock:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: Compute age and write summary
        shell: bash
        run: |
          FIRST=$(git log --reverse --format=%cI | head -n1)
          export FIRST
          python - << 'PY' | tee /tmp/clock.txt
            import os, datetime
            first = os.environ.get('FIRST', '')
            dt0 = datetime.datetime.fromisoformat(first.replace('Z','+00:00'))
            age = (datetime.datetime.now(datetime.timezone.utc) - dt0).days
            print(f"Project age: {age} days (since {dt0.date()})")
          PY
          echo "### Project Clock" >> "$GITHUB_STEP_SUMMARY"
          cat /tmp/clock.txt >> "$GITHUB_STEP_SUMMARY"
